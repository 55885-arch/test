<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>
<style>
body{font-family:Arial;padding:30px}
input,select{margin:5px 0;padding:6px;width:300px}
button{padding:8px 15px;margin-top:10px;cursor:pointer}
</style>
</head>
<body>

<h2>Upload Lesson to GitHub</h2>

<input type="text" id="token" placeholder="GitHub Token"><br>
<input type="text" id="owner" placeholder="GitHub Username"><br>
<input type="text" id="repo" placeholder="Repository Name"><br>

<hr>

<input type="text" id="title" placeholder="Title"><br>

<select id="subject">
<option>คณิตศาสตร์</option>
<option>พื้นฐาน</option>
<option>ฟิสิกส์</option>
<option>เคมี</option>
<option>ชีววิทยา</option>
<option>ภาษาไทย</option>
<option>ภาษาอังกฤษ</option>
<option>สังคม</option>
</select><br>

<select id="grade">
<option>ม.1</option>
<option>ม.2</option>
<option>ม.3</option>
<option>ม.4</option>
<option>ม.5</option>
<option>ม.6</option>
</select><br>

<input type="file" id="file"><br>

<button onclick="upload()">Upload</button>

<script>

async function upload(){

const token = document.getElementById("token").value;
const owner = document.getElementById("owner").value;
const repo = document.getElementById("repo").value;

const title = document.getElementById("title").value;
const subject = document.getElementById("subject").value;
const grade = document.getElementById("grade").value;

const fileInput = document.getElementById("file");
const file = fileInput.files[0];

if(!file) return alert("เลือกไฟล์ก่อน");

const reader = new FileReader();

reader.onload = async function() {

const base64File = reader.result.split(",")[1];
const filePath = "FilesFolder/" + file.name;

// 1️⃣ Upload file
await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${filePath}`,{
method:"PUT",
headers:{
"Authorization":"token " + token,
"Content-Type":"application/json"
},
body:JSON.stringify({
message:"Upload new lesson",
content:base64File
})
});

// 2️⃣ Get data.json
const res = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/data.json`,{
headers:{ "Authorization":"token " + token }
});
const data = await res.json();
const sha = data.sha;
const decoded = JSON.parse(atob(data.content));

// 3️⃣ Add new lesson
decoded.push({
title:title,
subject:subject,
category:"-",
grade:grade,
file:filePath
});

// 4️⃣ Update data.json
await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/data.json`,{
method:"PUT",
headers:{
"Authorization":"token " + token,
"Content-Type":"application/json"
},
body:JSON.stringify({
message:"Update data.json",
content:btoa(JSON.stringify(decoded,null,2)),
sha:sha
})
});

alert("Upload Complete!");

};

reader.readAsDataURL(file);

}

</script>

</body>
</html>
