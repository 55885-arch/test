<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>
<style>
body{font-family:Arial;padding:20px}
input,select{padding:5px;margin:3px}
table{border-collapse:collapse;margin-top:20px;width:100%}
th,td{border:1px solid #ccc;padding:6px;text-align:left}
button{padding:5px 10px;cursor:pointer}
</style>
</head>
<body>

<h2>Admin Data Manager</h2>

Token: <input type="password" id="token"><br>
Owner: <input type="text" id="owner"><br>
Repo: <input type="text" id="repo"><br>
<button onclick="loadData()">Load data.json</button>

<hr>

<h3>Add New Lesson</h3>
<input id="title" placeholder="Title">
<input id="subject" placeholder="Subject">
<input id="grade" placeholder="Grade (à¸¡.1)">
<input id="file" placeholder="FilesFolder/file.pdf">
<button onclick="addLesson()">Add</button>

<hr>

<h3>data.json Editor</h3>
<table id="table"></table>

<button onclick="saveData()">Save to GitHub</button>

<script>

let allData = [];
let dataSHA = "";

async function loadData(){

const token = document.getElementById("token").value;
const owner = document.getElementById("owner").value;
const repo = document.getElementById("repo").value;

const res = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/data.json`,{
headers:{ "Authorization":"token " + token }
});

const data = await res.json();
dataSHA = data.sha;
allData = JSON.parse(atob(data.content));
renderTable();
}

function renderTable(){

const table = document.getElementById("table");
table.innerHTML="";

table.innerHTML += `
<tr>
<th>Title</th>
<th>Subject</th>
<th>Grade</th>
<th>File</th>
<th>Delete</th>
</tr>
`;

allData.forEach((item,index)=>{
table.innerHTML += `
<tr>
<td><input value="${item.title}" onchange="allData[${index}].title=this.value"></td>
<td><input value="${item.subject}" onchange="allData[${index}].subject=this.value"></td>
<td><input value="${item.grade}" onchange="allData[${index}].grade=this.value"></td>
<td><input value="${item.file}" onchange="allData[${index}].file=this.value"></td>
<td><button onclick="deleteRow(${index})">X</button></td>
</tr>
`;
});
}

function addLesson(){

allData.push({
title:document.getElementById("title").value,
subject:document.getElementById("subject").value,
category:"-",
grade:document.getElementById("grade").value,
file:document.getElementById("file").value
});

renderTable();
}

function deleteRow(index){
allData.splice(index,1);
renderTable();
}

async function saveData(){

const token = document.getElementById("token").value;
const owner = document.getElementById("owner").value;
const repo = document.getElementById("repo").value;

await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/data.json`,{
method:"PUT",
headers:{
"Authorization":"token " + token,
"Content-Type":"application/json"
},
body:JSON.stringify({
message:"Update data.json via Admin GUI",
content:btoa(JSON.stringify(allData,null,2)),
sha:dataSHA
})
});

alert("Saved Successfully!");
}

</script>

</body>
</html>
