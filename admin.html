<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>
<style>
body{font-family:Arial;padding:20px}
input,select{padding:6px;margin:5px}
button{padding:6px 10px;margin:5px}
.card{border:1px solid #ccc;padding:10px;margin:10px 0}
</style>
</head>
<body>

<h2>üîê Admin Panel</h2>

<div id="loginBox">
    <input id="user" placeholder="Username">
    <input id="pass" type="password" placeholder="Password">
    <button onclick="login()">Login</button>
</div>

<div id="adminBox" style="display:none">

<h3>‡πÄ‡∏û‡∏¥‡πà‡∏° / ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Card</h3>

<input id="title" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô">

<select id="subject">
<option>‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</option>
<option>‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</option>
<option>‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢</option>
</select>

<select id="sub">
<option value="">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏°‡∏ß‡∏î‡∏¢‡πà‡∏≠‡∏¢</option>
<option>‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</option>
<option>‡∏ü‡∏¥‡∏™‡∏¥‡∏Å‡∏™‡πå</option>
<option>‡πÄ‡∏Ñ‡∏°‡∏µ</option>
<option>‡∏ä‡∏µ‡∏ß‡∏∞</option>
</select>

<select id="grade">
<option>‡∏°.1</option>
<option>‡∏°.2</option>
<option>‡∏°.3</option>
<option>‡∏°.4</option>
<option>‡∏°.5</option>
<option>‡∏°.6</option>
</select>

<br>

<input type="file" id="fileInput">
<button onclick="uploadFile()">Upload ‡πÑ‡∏õ GitHub</button>

<br>

<select id="fileSelect"></select>
<button onclick="loadFiles()">‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏≤‡∏Å GitHub</button>

<br><br>

<button onclick="saveCard()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Card</button>

<hr>

<h3>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ Card</h3>
<div id="cardList"></div>

</div>

<script>

// üî¥ ‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• repo ‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
const owner = "55885-arch";
const repo = "test";
const folder = "FilesFolder";
const token = "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";

let editIndex = null;

function login(){
    if(user.value==="ADMIN" && pass.value==="1234"){
        loginBox.style.display="none";
        adminBox.style.display="block";
        renderCards();
    }else{
        alert("‡∏ú‡∏¥‡∏î");
    }
}

function saveCard(){

    let data = JSON.parse(localStorage.getItem("schoolData")) || [];

    let obj = {
        title:title.value,
        subject:subject.value,
        sub:sub.value,
        grade:grade.value,
        file:fileSelect.value
    };

    if(editIndex!==null){
        data[editIndex]=obj;
        editIndex=null;
    }else{
        data.push(obj);
    }

    localStorage.setItem("schoolData",JSON.stringify(data));
    renderCards();
}

function renderCards(){
    let data = JSON.parse(localStorage.getItem("schoolData")) || [];
    cardList.innerHTML="";
    data.forEach((d,i)=>{
        cardList.innerHTML+=`
        <div class="card">
        ${d.title} (${d.grade})
        <br>
        <button onclick="editCard(${i})">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
        <button onclick="deleteCard(${i})">‡∏•‡∏ö</button>
        </div>`;
    });
}

function editCard(i){
    let data = JSON.parse(localStorage.getItem("schoolData"));
    let d = data[i];
    title.value=d.title;
    subject.value=d.subject;
    sub.value=d.sub;
    grade.value=d.grade;
    fileSelect.value=d.file;
    editIndex=i;
}

function deleteCard(i){
    let data = JSON.parse(localStorage.getItem("schoolData"));
    data.splice(i,1);
    localStorage.setItem("schoolData",JSON.stringify(data));
    renderCards();
}

/* ================= GITHUB API ================= */

async function uploadFile(){

    let file = fileInput.files[0];
    if(!file) return alert("‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏Å‡πà‡∏≠‡∏ô");

    let reader = new FileReader();
    reader.onload = async function(){

        let base64 = reader.result.split(',')[1];

        let res = await fetch(
        `https://api.github.com/repos/${owner}/${repo}/contents/${folder}/${file.name}`,{
            method:"PUT",
            headers:{
                "Authorization":"token "+token,
                "Content-Type":"application/json"
            },
            body:JSON.stringify({
                message:"upload file",
                content:base64
            })
        });

        let result = await res.json();
        alert("Upload ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
        loadFiles();
    };

    reader.readAsDataURL(file);
}

async function loadFiles(){

    let res = await fetch(
    `https://api.github.com/repos/${owner}/${repo}/contents/${folder}`,{
        headers:{
            "Authorization":"token "+token
        }
    });

    let files = await res.json();
    fileSelect.innerHTML="";

    files.forEach(f=>{
        fileSelect.innerHTML+=
        `<option value="${f.download_url}">
        ${f.name}
        </option>`;
    });
}

async function deleteGitHubFile(filename,sha){

    await fetch(
    `https://api.github.com/repos/${owner}/${repo}/contents/${folder}/${filename}`,{
        method:"DELETE",
        headers:{
            "Authorization":"token "+token,
            "Content-Type":"application/json"
        },
        body:JSON.stringify({
            message:"delete file",
            sha:sha
        })
    });

    alert("‡∏•‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
}

</script>

</body>
</html>
